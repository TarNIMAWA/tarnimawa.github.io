<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<title>åœ°çƒonline</title>
<style>
  body {
    margin: 0; padding: 0;
    background-color: #222222;
    color: #33ff33;
    font-family: 'Courier New', monospace;
    display: flex;
    height: 100vh;
    overflow: hidden;
    user-select: none;
  }
  #left {
    width: 50%;
    border-right: 1px solid #33ff33;
    padding: 20px;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
  }
  #title {
    color: #00bfff;
    font-size: 2.8rem;
    font-weight: bold;
    margin-bottom: 10px;
    user-select: none;
  }
  #ipInfo {
    margin-bottom: 20px;
    font-size: 1.2rem;
    color: #ffff66;
    user-select: none;
  }
  #terminal {
    flex: 1;
    background: #000;
    padding: 10px;
    border-radius: 5px;
    overflow-y: auto;
    white-space: pre-wrap;
    font-size: 14px;
    line-height: 1.4;
    box-shadow: 0 0 8px #33ff33aa inset;
  }
  #commandInput {
    margin-top: 10px;
    background: #000;
    border: 1px solid #33ff33;
    color: #33ff33;
    font-family: 'Courier New', monospace;
    font-size: 16px;
    padding: 8px;
    border-radius: 4px;
    outline: none;
    width: 100%;
    box-sizing: border-box;
  }
  #right {
    width: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    background: #222222;
    user-select: none;
    position: relative;
  }
  canvas {
    width: 320px;
    height: 320px;
    border-radius: 50%;
    box-shadow: 0 0 15px #00bfff88;
    display: block;
  }
  /* åœ°çƒè½®å»“çº¿ */
  .line {
    stroke: #00bfff;
    stroke-opacity: 0.7;
    fill: none;
    stroke-width: 1.2;
  }

  /* æ™ºèƒ½å®¢æœçª—å£ */
  #chatBot {
    position: fixed;
    bottom: 15px;
    right: 15px;
    width: 320px;
    max-height: 420px;
    background: #111;
    border: 2px solid #00bfff;
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    font-size: 14px;
    color: #33ff33;
    box-shadow: 0 0 12px #00bfffaa;
    user-select: text;
    z-index: 1000;
  }
  #chatHeader {
    background: #003366;
    padding: 8px 12px;
    font-weight: bold;
    cursor: pointer;
    user-select: none;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  #chatHeader span.closeBtn {
    cursor: pointer;
    font-weight: normal;
    color: #ff4444;
  }
  #chatContent {
    flex: 1;
    padding: 8px 12px;
    overflow-y: auto;
    background: #000;
    white-space: pre-wrap;
  }
  #chatInputArea {
    border-top: 1px solid #00bfff;
    display: flex;
  }
  #chatInput {
    flex: 1;
    background: #000;
    border: none;
    color: #33ff33;
    padding: 8px 10px;
    font-family: 'Courier New', monospace;
    font-size: 14px;
    outline: none;
  }
  #chatSendBtn {
    background: #00bfff;
    border: none;
    color: #000;
    font-weight: bold;
    padding: 0 15px;
    cursor: pointer;
    transition: background 0.3s;
  }
  #chatSendBtn:hover {
    background: #33ccff;
  }
  #chatToggleBtn {
    position: fixed;
    bottom: 15px;
    right: 15px;
    background: #00bfff;
    border-radius: 50%;
    width: 48px;
    height: 48px;
    color: #000;
    font-weight: bold;
    font-size: 28px;
    line-height: 48px;
    text-align: center;
    cursor: pointer;
    user-select: none;
    box-shadow: 0 0 12px #00bfffaa;
    z-index: 1000;
    display: block;
  }
</style>
</head>
<body>
  <div id="left">
    <div id="title">æ¬¢è¿åœ°çƒç®¡ç†å‘˜è¿›å…¥åœ°çƒonline</div>
    <div id="ipInfo">æ‚¨æ‰€åœ¨æœåŠ¡åŒºåŸŸä¸º <span id="ip">å®šä½ä¸­...</span></div>
    <div id="terminal">è¾“å…¥ /help æŸ¥çœ‹æŒ‡ä»¤åˆ—è¡¨</div>
    <input id="commandInput" placeholder="è¯·è¾“å…¥æŒ‡ä»¤ï¼Œä¾‹å¦‚ /help" autocomplete="off" autofocus />
  </div>
  <div id="right">
    <canvas id="globeCanvas" width="320" height="320"></canvas>
    <svg id="globeLines" width="320" height="320" style="position:absolute; top:50%; left:50%; transform: translate(-50%, -50%); pointer-events:none;">
      <path class="line" d="M160,60 C210,100 210,220 160,260" />
      <path class="line" d="M140,60 C90,100 90,220 140,260" />
      <path class="line" d="M110,80 C160,100 160,220 110,240" />
    </svg>
  </div>

  <!-- æ™ºèƒ½å®¢æœçª—å£ -->
  <div id="chatBot" style="display:none;">
    <div id="chatHeader">åœ°çƒonlineæ™ºèƒ½å®¢æœ <span class="closeBtn" title="å…³é—­å®¢æœ">âœ–</span></div>
    <div id="chatContent"></div>
    <div id="chatInputArea">
      <input id="chatInput" placeholder="è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ç™»å½•å®¢æœ" />
      <button id="chatSendBtn">å‘é€</button>
    </div>
  </div>
  <div id="chatToggleBtn" title="æ‰“å¼€æ™ºèƒ½å®¢æœ">ğŸ’¬</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.134.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.134.0/examples/js/controls/OrbitControls.js"></script>
<script>
  // IPè·å–
  fetch('https://api.ipify.org?format=json')
    .then(res => res.json())
    .then(data => {
      document.getElementById('ip').textContent = data.ip;
    })
    .catch(() => {
      document.getElementById('ip').textContent = 'æœªçŸ¥';
    });

  const terminal = document.getElementById('terminal');
  const input = document.getElementById('commandInput');

  function randomChoice(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
  }

  // å‘½ä»¤å¤„ç†å‡½æ•°ï¼ˆå«æ‰€æœ‰æŒ‡ä»¤ï¼‰
  function generateAIResponse(command, arg) {
    switch (command) {
      case "climate_change":
        return randomChoice([
          "æ°”å€™å˜åŒ–æ—¥ç›Šä¸¥é‡ï¼Œå†°å·æŒç»­èåŒ–ï¼Œå…¨çƒéƒ½åœ¨æ„Ÿå—åˆ°å®ƒçš„å½±å“ã€‚",
          "æ°”å€™æ­£åœ¨å˜æš–ï¼Œæç«¯å¤©æ°”é¢‘å‘ï¼Œè¯·æ³¨æ„é˜²èŒƒã€‚",
          "ç§‘å­¦å®¶è­¦å‘Šï¼šæ°”å€™å˜åŒ–å½±å“æ·±è¿œï¼Œéœ€è¦å…¨çƒåˆä½œã€‚"
        ]);
      case "population_growth":
        return randomChoice([
          "äººå£ä¸æ–­å¢é•¿ï¼ŒåŸå¸‚å˜å¾—è¶Šæ¥è¶Šæ‹¥æŒ¤ã€‚",
          "äººå£å‹åŠ›å¤§ï¼Œèµ„æºåˆ†é…éœ€è¦ä¼˜åŒ–ã€‚",
          "å¢é•¿çš„äººå£ä¸ºä¸–ç•Œå¸¦æ¥äº†æŒ‘æˆ˜å’Œæœºé‡ã€‚"
        ]);
      case "volcanic_eruption":
        return randomChoice([
          "ç«å±±çˆ†å‘ï¼å¤©ç©ºä¸­å¼¥æ¼«ç€ç°çƒ¬å’Œç¡«ç£ºå‘³ã€‚",
          "å¼ºçƒˆçš„ç«å±±æ´»åŠ¨å½±å“äº†å½“åœ°å±…æ°‘çš„ç”Ÿæ´»ã€‚",
          "ç«å±±ç°è¦†ç›–åœŸåœ°ï¼Œæš‚æ—¶é˜»æ–­äº†äº¤é€šã€‚"
        ]);
      case "glacier_melting":
        return randomChoice([
          "å†°å·åŠ é€ŸèåŒ–ï¼Œæµ·å¹³é¢ç¼“æ…¢ä¸Šå‡ã€‚",
          "æ·¡æ°´èµ„æºç´§å¼ ï¼Œç”Ÿæ€ç³»ç»Ÿé­å—å†²å‡»ã€‚",
          "å†°å·çš„å˜åŒ–æ­£åœ¨æ”¹å˜åœ°çƒçš„é¢è²Œã€‚"
        ]);
      case "water_crisis":
        return randomChoice([
          "æ°´èµ„æºçŸ­ç¼ºï¼Œå±…æ°‘ç”Ÿæ´»å—åˆ°å½±å“ã€‚",
          "æ°´è´¨æ±¡æŸ“åŠ é‡ï¼Œéœ€è¦ç´§æ€¥å¤„ç†ã€‚",
          "æ°´æºä¿æŠ¤åˆ»ä¸å®¹ç¼“ï¼Œå¤§å®¶éœ€èŠ‚çº¦ç”¨æ°´ã€‚"
        ]);
      case "extreme_weather":
        return randomChoice([
          "æç«¯å¤©æ°”é¢‘ç¹å‡ºç°ï¼Œå¸¦æ¥ç¾å®³é£é™©ã€‚",
          "é£æš´ã€æ´ªæ°´ã€å¹²æ—±ï¼Œå½±å“å†œä¸šç”Ÿäº§ã€‚",
          "æ°”å€™å¼‚å¸¸å¼•å‘ç¤¾ä¼šå…³æ³¨ã€‚"
        ]);
      case "earth_observation":
        return randomChoice([
          "å«æ˜Ÿå®æ—¶ç›‘æ§åœ°çƒç¯å¢ƒï¼Œæ•°æ®ç²¾å‡†å¯é ã€‚",
          "è§‚æµ‹ç³»ç»Ÿå‡çº§ï¼Œæå‡ç¾å®³é¢„è­¦èƒ½åŠ›ã€‚",
          "å…¨çƒç›‘æµ‹ç½‘ç»œåŠ©åŠ›ç§‘å­¦ç ”ç©¶ã€‚"
        ]);
      case "deforestation":
        return randomChoice([
          "æ£®æ—ç ä¼ä¸¥é‡ï¼Œç”Ÿç‰©å¤šæ ·æ€§å—æŸã€‚",
          "ç¢³æ±‡èƒ½åŠ›ä¸‹é™ï¼Œæ°”å€™å‹åŠ›åŠ å‰§ã€‚",
          "æ£®æ—ä¿æŠ¤ä»»åŠ¡åˆ»ä¸å®¹ç¼“ã€‚"
        ]);
      case "urban_expansion":
        return randomChoice([
          "åŸå¸‚ä¸æ–­æ‰©å¼ ï¼Œç»¿åœ°é¢ç§¯å‡å°‘ã€‚",
          "äº¤é€šæ‹¥å µå’Œç©ºæ°”æ±¡æŸ“æ—¥ç›Šä¸¥é‡ã€‚",
          "åŸå¸‚è§„åˆ’éœ€æ›´åŠ åˆç†ä¸ç¯ä¿ã€‚"
        ]);
      case "geographical_exploration":
        return randomChoice([
          "æ–°çš„åœ°ç†å‘ç°æ‹“å±•äº†äººç±»è®¤çŸ¥ã€‚",
          "æ¢é™©é˜Ÿå¸¦å›ä¸°å¯Œçš„ç§‘å­¦æ•°æ®ã€‚",
          "åœ°å›¾ä¿¡æ¯æ›´æ–°å®Œå–„ã€‚"
        ]);
      case "energy_crisis":
        return randomChoice([
          "ä¼ ç»Ÿèƒ½æºæ¯ç«­ï¼Œæ–°èƒ½æºéœ€æ±‚æ”€å‡ã€‚",
          "èŠ‚èƒ½å‡æ’æˆä¸ºé‡è¦è¯¾é¢˜ã€‚",
          "èƒ½æºä¾›éœ€ç´§å¼ ï¼Œå½±å“ç»æµå‘å±•ã€‚"
        ]);
      case "permafrost_change":
        return randomChoice([
          "å†»åœŸèåŒ–é‡Šæ”¾å¤§é‡æ¸©å®¤æ°”ä½“ï¼ŒåŠ å‰§æ°”å€™å˜æš–ã€‚",
          "åŒ—æåœ°åŒºåŸºç¡€è®¾æ–½é¢ä¸´é£é™©ã€‚",
          "ç”Ÿæ€ç³»ç»Ÿåé¦ˆæ•ˆåº”åŠ å¿«ã€‚"
        ]);
      case "solar_activity":
        return randomChoice([
          "å¤ªé˜³æ´»åŠ¨å¢å¼ºï¼Œæå…‰é¢‘ç¹å‡ºç°ã€‚",
          "å¤ªé˜³é£æš´å¯èƒ½å¹²æ‰°å«æ˜Ÿé€šä¿¡ã€‚",
          "ç§‘å­¦å®¶å¯†åˆ‡ç›‘æµ‹å¤ªé˜³å˜åŒ–ã€‚"
        ]);
      case "ocean_current_change":
        return randomChoice([
          "æ´‹æµå˜åŒ–å¯¼è‡´æ°”å€™æ¨¡å¼è°ƒæ•´ã€‚",
          "æµ·æ´‹ç”Ÿæ€ç³»ç»Ÿæ‰¿å—å‹åŠ›ã€‚",
          "æ²¿æµ·å¤©æ°”è¡¨ç°å‡ºå¼‚å¸¸æ³¢åŠ¨ã€‚"
        ]);
      case "disaster_alert":
        return randomChoice([
          "ç¾å®³é¢„è­¦å·²å‘å‡ºï¼Œè¯·åšå¥½é˜²èŒƒã€‚",
          "ç´§æ€¥å“åº”ç³»ç»Ÿå¯åŠ¨ï¼Œä¿éšœå®‰å…¨ã€‚",
          "æ°‘ä¼—ç§¯æé…åˆé˜²ç¾å·¥ä½œã€‚"
        ]);
      case "pause_simulation":
        return randomChoice([
          "æ¨¡æ‹Ÿå™¨å·²æš‚åœï¼Œæ‰€æœ‰åŠ¨æ€åœæ­¢ã€‚",
          "ç³»ç»Ÿè¿›å…¥å¾…å‘½çŠ¶æ€ï¼Œç­‰å¾…ç»§ç»­æŒ‡ä»¤ã€‚",
          "æš‚åœæˆåŠŸï¼Œè¾“å…¥ /resume æ¢å¤è¿è¡Œã€‚"
        ]);
      case "resume_simulation":
        return randomChoice([
          "æ¨¡æ‹Ÿå™¨æ¢å¤è¿è¡Œï¼ŒåŠ¨æ€ç»§ç»­ã€‚",
          "ç³»ç»Ÿé‡æ–°æ¿€æ´»ï¼Œæ¬¢è¿å›æ¥ã€‚",
          "è¿è¡Œå·²æ¢å¤ï¼Œç¥æ‚¨æ“ä½œé¡ºåˆ©ã€‚"
        ]);
      case "select_resident":
        return randomChoice([
          "è¯·è¾“å…¥å±…æ°‘ç¼–å·è¿›è¡Œå¯¹è¯ï¼Œä¾‹å¦‚ï¼š123 ä½ å¥½",
          "å±…æ°‘äº’åŠ¨åŠŸèƒ½ä¸Šçº¿ï¼Œè¾“å…¥å±…æ°‘IDå’Œæ¶ˆæ¯å¼€å§‹èŠå¤©ã€‚",
          "å±…æ°‘èŠå¤©æ¨¡æ‹Ÿå·²å¯åŠ¨ã€‚"
        ]);
      case "view_instructions":
        return randomChoice([
          "åœ°çƒonlineæ¨¡æ‹Ÿå™¨ï¼Œè¾“å…¥æŒ‡ä»¤æ“æ§ä¸–ç•Œã€‚",
          "è¾“å…¥ /help æŸ¥çœ‹æ‰€æœ‰æŒ‡ä»¤åŠè¯´æ˜ã€‚",
          "ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼"
        ]);
      case "biodiversity":
        return randomChoice([
          "ç”Ÿç‰©å¤šæ ·æ€§ä¸‹é™ï¼Œç”Ÿæ€ç³»ç»Ÿé¢ä¸´å¨èƒã€‚",
          "ä¿æŠ¤ç‰©ç§åˆ»ä¸å®¹ç¼“ã€‚",
          "ç”Ÿæ€ä¿æŠ¤å–å¾—äº†ä¸€å®šè¿›å±•ã€‚"
        ]);
      case "human_activity_impact":
        return randomChoice([
          "äººç±»æ´»åŠ¨å¯¹ç¯å¢ƒäº§ç”Ÿäº†å·¨å¤§å½±å“ã€‚",
          "æ±¡æŸ“å’Œèµ„æºè¿‡åº¦ä½¿ç”¨éœ€æ§åˆ¶ã€‚",
          "ç»¿è‰²å‘å±•æ˜¯æœªæ¥æ–¹å‘ã€‚"
        ]);
      case "money":
        if (!arg || isNaN(arg)) return "è¯·æŒ‡å®šæ­£ç¡®çš„é‡‘é¢ï¼Œä¾‹å¦‚ /money 100";
        return randomChoice([
          `[å±…æ°‘E] å“¦è±ä»Šå¤©å‘é’±äº†ï¼æˆ‘ä¹°ç“¶â€œåœ°çƒæ°´â€å»ï½ï¼ˆ${arg}å…ƒï¼‰`,
          `[å±…æ°‘E] é¢†åˆ°äº†${arg}å…ƒï¼Œç”Ÿæ´»æœ‰ç›¼å¤´äº†ï¼`,
          `[å±…æ°‘E] æ”¶åˆ°${arg}å…ƒï¼Œæ„Ÿè°¢ç®¡ç†å‘˜çš„å…³æ€€ï¼`
        ]);
      case "geo":
        return randomChoice([
          "[å±…æ°‘F] åœ°ç†é¢˜åˆ°äº†ï¼åˆšå¥½æˆ‘æƒ³å­¦â€œå–€æ–¯ç‰¹åœ°è²Œâ€ã€‚",
          "[å±…æ°‘F] åœ°ç†æµ‹è¯•é¢˜å‘æ”¾å®Œæ¯•ï¼ŒæœŸå¾…å¤§å®¶çš„å¥½æˆç»©ã€‚",
          "[å±…æ°‘F] æ–°çš„åœ°ç†é¢˜ç›®å·²ä¸Šçº¿ï¼Œæ¿€å‘æ¢ç´¢å…´è¶£ã€‚"
        ]);
      case "weather":
        return randomChoice([
          "[å±…æ°‘G] æµ·é£å¤ªå¤§äº†å§ï¼Œè¡£æœéƒ½å¹é£å•¦ï¼",
          "[å±…æ°‘G] ä»Šå¤©é˜³å…‰æ˜åªšï¼Œé€‚åˆå‡ºè¡Œã€‚",
          "[å±…æ°‘G] ä¸‹é›¨äº†ï¼Œè®°å¾—å¸¦ä¼å“¦ï¼"
        ]);
      case "build":
        if (!arg) return "è¯·æŒ‡å®šå»ºé€ å¯¹è±¡ï¼Œä¾‹å¦‚ /build å·¥å‚";
        return randomChoice([
          "[å±…æ°‘H] è°åœ¨æˆ‘å®¶æ—è¾¹ç›–å‚ï¼Ÿç©ºæ°”è´¨é‡è­¦å‘Šï¼",
          "[å±…æ°‘H] æ–°å·¥å‚å¼€å§‹è¿ä½œï¼Œå¸¦æ¥å°±ä¸šæœºä¼šã€‚",
          "[å±…æ°‘H] å»ºé€ å·¥å‚ä¸­ï¼Œæ³¨æ„ç¯ä¿ã€‚"
        ]);
      case "tax":
        if (!arg || !/^(\+|-)?\d+%$/.test(arg)) return "è¯·æŒ‡å®šæ­£ç¡®çš„ç¨ç‡å˜åŠ¨ï¼Œä¾‹å¦‚ /tax +5%";
        return randomChoice([
          `[å±…æ°‘I] ä¸æ˜¯å§ï¼Œè¿™ä¸ªæœˆåˆšäº¤å®Œï¼Œå±…ç„¶æ¶¨ç¨${arg}ï¼`,
          `[å±…æ°‘I] ç¨æ”¶æé«˜äº†${arg}ï¼Œç”Ÿæ´»å‹åŠ›åŠ å¤§ã€‚`,
          `[å±…æ°‘I] æ–°çš„ç¨ç‡è°ƒæ•´ï¼Œå¤§å®¶å…±åŒåŠªåŠ›ã€‚`
        ]);
      case "ban":
        if (!arg) return "è¯·æŒ‡å®šè¦ç¦è¨€çš„ç”¨æˆ·åï¼Œä¾‹å¦‚ /ban å°ç‹";
        return randomChoice([
          `[å±…æ°‘J] ${arg}æ€ä¹ˆä¸è¯´è¯äº†ï¼Œæ˜¯ä¸æ˜¯éª‚äººè¢«æŠ“ï¼Ÿ`,
          `[å±…æ°‘J] ${arg}è¢«ç¦è¨€äº†ï¼Œå¤§å®¶æ³¨æ„è¨€è¾ã€‚`,
          `[å±…æ°‘J] ç¦è¨€æªæ–½ä¸¥æ ¼ï¼Œç¤¾åŒºæ°›å›´æ›´å¥½äº†ã€‚`
        ]);
      case "travel":
        if (!arg) return "è¯·æŒ‡å®šæ—…è¡Œç›®çš„åœ°ï¼Œä¾‹å¦‚ /travel äº‘å—";
        return randomChoice([
          `[å±…æ°‘K] ${arg}ç¾çˆ†äº†ï¼Œç®¡ç†å‘˜æ‡‚ç©ï¼`,
          `[å±…æ°‘K] å…¨ä½“æ—…è¡Œ${arg}ï¼Œå¥½å¼€å¿ƒï¼`,
          `[å±…æ°‘K] ${arg}é£æ™¯çœŸèµï¼ŒæœŸå¾…ä¸‹ä¸€æ¬¡æ—…è¡Œã€‚`
        ]);
      case "geobook":
        return randomChoice([
          "åœ°çƒç§‘å­¦çŸ¥è¯†ï¼šåœ°å£³ä¸»è¦ç”±ç¡…å’Œæ°§ç»„æˆã€‚",
          "åœ°çƒç§‘å­¦çŸ¥è¯†ï¼šç«å±±å–·å‘é‡Šæ”¾çš„å²©æµ†ä¼šå½¢æˆæ–°çš„åœ°è´¨ç»“æ„ã€‚",
          "åœ°çƒç§‘å­¦çŸ¥è¯†ï¼šæ¿å—è¿åŠ¨æ˜¯åœ°éœ‡çš„ä¸»è¦åŸå› ã€‚",
          "åœ°çƒç§‘å­¦çŸ¥è¯†ï¼šæµ·æ´‹è¦†ç›–äº†åœ°çƒè¡¨é¢çš„70%ä»¥ä¸Šã€‚",
          "åœ°çƒç§‘å­¦çŸ¥è¯†ï¼šå†°å·å¯¹åœ°è²Œæœ‰ç€æ·±è¿œçš„å½±å“ã€‚"
        ]);
      case "kill":
        if (!arg) return "è¯·æŒ‡å®šè¦æŠ¹é™¤çš„ç›®æ ‡ï¼Œæ ¼å¼ï¼š/kill ç›®æ ‡ [åŸå› ]";
        const parts = arg.split(' ');
        const target = parts[0];
        const reason = parts.slice(1).join(' ') || "æ— å…·ä½“åŸå› ";
        return `ç”¨æˆ·â€œ${target}â€å·²è¢«æŠ¹é™¤ï¼ŒåŸå› ï¼š${reason}\nç¤¾åŒºç¯å¢ƒå·²æ›´æ–°ã€‚`;
      case "help":
        return [
          "åœ°çƒonlineå¯ç”¨æŒ‡ä»¤ï¼š",
          "/money {é‡‘é¢} - å‘é’±ç»™å±…æ°‘",
          "/ban {ç”¨æˆ·å} - ç¦è¨€ç”¨æˆ·",
          "/geo - å‘å¸ƒåœ°ç†é¢˜ç›®",
          "/travel {åœ°ç‚¹} - ç»„ç»‡æ—…è¡Œ",
          "/geobook - æ™®åŠåœ°çƒç§‘å­¦çŸ¥è¯†",
          "/kill {ç›®æ ‡} [åŸå› ] - æŠ¹é™¤ç”¨æˆ·",
          "/build {å»ºç­‘} - å»ºé€ è®¾æ–½",
          "/tax {å˜åŠ¨%} - è°ƒæ•´ç¨ç‡",
          "/weather - å¤©æ°”ç›¸å…³",
          "/pause_simulation - æš‚åœæ¨¡æ‹Ÿå™¨",
          "/resume_simulation - æ¢å¤æ¨¡æ‹Ÿå™¨",
          "/help - æ˜¾ç¤ºå¸®åŠ©"
        ].join('\n');
      default:
        return "æœªçŸ¥æŒ‡ä»¤ï¼Œè¯·è¾“å…¥ /help æŸ¥çœ‹æ‰€æœ‰æŒ‡ä»¤ã€‚";
    }
  }

  // ç»ˆç«¯è¾“å‡ºå‡½æ•°ï¼Œè‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
  function appendTerminal(text) {
    terminal.textContent += "\n" + text;
    terminal.scrollTop = terminal.scrollHeight;
  }

  // è¾“å…¥å¤„ç†
  input.addEventListener('keydown', e => {
    if (e.key === 'Enter') {
      let val = input.value.trim();
      if (!val) return;
      appendTerminal("> " + val);

      if (val.startsWith('/')) {
        // è§£ææŒ‡ä»¤å’Œå‚æ•°
        let spaceIdx = val.indexOf(' ');
        let cmd = '';
        let arg = '';
        if (spaceIdx === -1) {
          cmd = val.slice(1).toLowerCase();
        } else {
          cmd = val.slice(1, spaceIdx).toLowerCase();
          arg = val.slice(spaceIdx + 1);
        }

        // å®¢æœå‘½ä»¤ç‰¹æ®Šå¤„ç†
        if(cmd === 'å®¢æœ' || cmd === 'chatbot'){
          chatToggle(true);
          appendTerminal("å·²æ‰“å¼€æ™ºèƒ½å®¢æœï¼Œè¾“å…¥ç®¡ç†å‘˜å¯†ç ç™»å½•ã€‚");
          input.value = '';
          return;
        }

        // å¯†ç éªŒè¯å‘½ä»¤ï¼ˆç¤ºä¾‹ï¼Œè¾“å…¥ /password 123456ï¼‰
        if(cmd === 'password'){
          if(arg === '123456'){
            appendTerminal("ç®¡ç†å‘˜å¯†ç éªŒè¯é€šè¿‡ï¼Œæ™ºèƒ½å®¢æœå·²è§£é”ã€‚");
            chatbotUnlocked = true;
          } else {
            appendTerminal("ç®¡ç†å‘˜å¯†ç é”™è¯¯ï¼");
          }
          input.value = '';
          return;
        }

        // å¤„ç†æŒ‡ä»¤
        let res = generateAIResponse(cmd, arg);
        appendTerminal(res);
      } else {
        appendTerminal("è¯·ä»¥ / å¼€å¤´è¾“å…¥æŒ‡ä»¤ã€‚");
      }
      input.value = '';
    }
  });

const canvas = document.getElementById('globeCanvas');
  const renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: true });
  renderer.setSize(canvas.clientWidth, canvas.clientHeight);

  const scene = new THREE.Scene();

  const camera = new THREE.PerspectiveCamera(45, canvas.clientWidth / canvas.clientHeight, 0.1, 1000);
  camera.position.z = 3;

  // çº¹ç†åŠ è½½å™¨
  const textureLoader = new THREE.TextureLoader();

  // åœ°çƒä¸»ä½“åŠé€æ˜è“è‰²
  const earthGeometry = new THREE.SphereGeometry(1, 64, 64);
  const earthMaterial = new THREE.MeshPhongMaterial({
    color: 0x00aaff,
    transparent: true,
    opacity: 0.5,
    shininess: 30,
    side: THREE.DoubleSide,
  });
  const earthMesh = new THREE.Mesh(earthGeometry, earthMaterial);
  scene.add(earthMesh);

  // ç§»é™¤åŸå¯†é›†wireframeï¼Œæ”¹æˆç¨€ç–çš„ç»çº¬çº¿è½®å»“

  // çº¿æ¡æè´¨
  const lineMaterial = new THREE.LineBasicMaterial({
    color: 0x66ccff,
    transparent: true,
    opacity: 0.7,
  });

  // åˆ›å»ºçº¿æ¡ç»„
  const linesGroup = new THREE.Group();

  // ç»çº¿7æ¡ï¼ˆé—´éš”çº¦30åº¦ï¼‰
  for (let i = 0; i < 7; i++) {
    const lon = (i * Math.PI) / 6 - Math.PI / 2; // -90Â° åˆ° +90Â°
    const points = [];
    for (let lat = -Math.PI / 2; lat <= Math.PI / 2; lat += 0.01) {
      const x = Math.cos(lat) * Math.cos(lon);
      const y = Math.sin(lat);
      const z = Math.cos(lat) * Math.sin(lon);
      points.push(new THREE.Vector3(x, y, z));
    }
    const geometry = new THREE.BufferGeometry().setFromPoints(points);
    const line = new THREE.Line(geometry, lineMaterial);
    linesGroup.add(line);
  }

  // çº¬çº¿3æ¡ï¼ˆé—´éš”çº¦30åº¦ï¼‰
  const latitudes = [-Math.PI / 6, 0, Math.PI / 6]; // -30Â°, 0Â°, +30Â°
  latitudes.forEach(lat => {
    const points = [];
    for (let lon = -Math.PI; lon <= Math.PI; lon += 0.01) {
      const x = Math.cos(lat) * Math.cos(lon);
      const y = Math.sin(lat);
      const z = Math.cos(lat) * Math.sin(lon);
      points.push(new THREE.Vector3(x, y, z));
    }
    const geometry = new THREE.BufferGeometry().setFromPoints(points);
    const line = new THREE.Line(geometry, lineMaterial);
    linesGroup.add(line);
  });

  scene.add(linesGroup);

  // ç§‘æŠ€ç½‘æ ¼çº¹ç†çƒ
  const techGridTexture = textureLoader.load('https://i.imgur.com/s8uZNEZ.png');
  const techGeometry = new THREE.SphereGeometry(1.01, 64, 64);
  const techMaterial = new THREE.MeshPhongMaterial({
    map: techGridTexture,
    transparent: true,
    opacity: 0.3,
    shininess: 0,
    side: THREE.DoubleSide,
    blending: THREE.AdditiveBlending,
    depthWrite: false,
  });
  const techMesh = new THREE.Mesh(techGeometry, techMaterial);
  scene.add(techMesh);

  // å…‰æº
  const ambientLight = new THREE.AmbientLight(0x8888aa);
  scene.add(ambientLight);

  const directionalLight = new THREE.DirectionalLight(0x00bfff, 1.2);
  directionalLight.position.set(5, 3, 5);
  scene.add(directionalLight);

  // æ§åˆ¶å™¨
  const controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableZoom = true;
  controls.minDistance = 1.5;
  controls.maxDistance = 4;

  // çª—å£è°ƒæ•´å°ºå¯¸
  function onWindowResize() {
    const width = canvas.clientWidth;
    const height = canvas.clientHeight;
    renderer.setSize(width, height);
    camera.aspect = width / height;
    camera.updateProjectionMatrix();
  }
  window.addEventListener('resize', onWindowResize);
  onWindowResize();

  // åŠ¨ç”»å¾ªç¯
  function animate() {
    requestAnimationFrame(animate);
    earthMesh.rotation.y += 0.0007;
    linesGroup.rotation.y += 0.0007;
    techMesh.rotation.y += 0.0007;
    controls.update();
    renderer.render(scene, camera);
  }
  animate();


  // ---------- æ™ºèƒ½å®¢æœ ---------- //
  const chatBot = document.getElementById('chatBot');
  const chatToggleBtn = document.getElementById('chatToggleBtn');
  const chatCloseBtn = document.querySelector('#chatBot .closeBtn');
  const chatContent = document.getElementById('chatContent');
  const chatInput = document.getElementById('chatInput');
  const chatSendBtn = document.getElementById('chatSendBtn');

  let chatbotUnlocked = false;

  function chatToggle(show) {
    if (show === undefined) {
      if (chatBot.style.display === 'none' || chatBot.style.display === '') {
        show = true;
      } else {
        show = false;
      }
    }
    chatBot.style.display = show ? 'flex' : 'none';
    chatToggleBtn.style.display = show ? 'none' : 'block';
    if(show) chatInput.focus();
  }

  chatToggleBtn.addEventListener('click', () => {
    chatToggle(true);
  });
  chatCloseBtn.addEventListener('click', () => {
    chatToggle(false);
  });

  // èŠå¤©å†…å®¹è¿½åŠ 
  function appendChat(text, isUser = false) {
    const div = document.createElement('div');
    div.textContent = text;
    div.style.marginBottom = '6px';
    div.style.whiteSpace = 'pre-wrap';
    div.style.color = isUser ? '#00ffff' : '#33ff33';
    chatContent.appendChild(div);
    chatContent.scrollTop = chatContent.scrollHeight;
  }

  // å®¢æœæ¶ˆæ¯å¤„ç†
  function chatbotResponse(msg) {
    if (!chatbotUnlocked) {
      if (msg === '123456') {
        chatbotUnlocked = true;
        appendChat("ç®¡ç†å‘˜å¯†ç æ­£ç¡®ï¼Œæ™ºèƒ½å®¢æœå·²è§£é”ã€‚");
      } else {
        appendChat("ç®¡ç†å‘˜å¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥ã€‚");
      }
      return;
    }
    // ç®€å•æ™ºèƒ½å®¢æœå›å¤ç¤ºä¾‹
    const lower = msg.toLowerCase();
    if (lower.includes('å¸®åŠ©') || lower.includes('æŒ‡ä»¤')) {
      appendChat("ä½ å¯ä»¥è¾“å…¥æŒ‡ä»¤ï¼Œä¾‹å¦‚ /money, /ban, /geo, /travel, /geobook, /kill ç­‰ã€‚");
    } else if (lower.includes('åœ°çƒ')) {
      appendChat("åœ°çƒæ˜¯æˆ‘ä»¬èµ–ä»¥ç”Ÿå­˜çš„å®¶å›­ï¼Œä¿æŠ¤ç¯å¢ƒåˆ»ä¸å®¹ç¼“ã€‚");
    } else {
      appendChat("æ„Ÿè°¢æ‚¨çš„ç•™è¨€ï¼Œç®¡ç†å‘˜ç¨åå›å¤ã€‚");
    }
  }

  // å‘é€æŒ‰é’®å’Œå›è½¦äº‹ä»¶
  chatSendBtn.addEventListener('click', () => {
    let val = chatInput.value.trim();
    if(!val) return;
    appendChat("ç®¡ç†å‘˜ï¼š" + val, true);
    chatbotResponse(val);
    chatInput.value = '';
  });
  chatInput.addEventListener('keydown', e => {
    if(e.key === 'Enter') {
      chatSendBtn.click();
    }
  });
</script>
</body>
</html>

